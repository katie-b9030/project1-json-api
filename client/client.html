<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Movies API</title>
    <link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>
    <section id="header">
        <h1>Disney Movie API</h1>
        <a href="../resources/documentation.txt">API Documentation</a>
        <div id="selectorButtons">

        </div>
    </section>
    <div id="requests">
        <!-- Test all movies endpoint-->
        <section id="allMovies" class="endpoint">
            <h2>Test all movies</h2>
            <form data-method="GET" action="/allMovies">
                <div class="inputSection">
                    <label for="title">Title: </label>
                    <input id="titleField" type="text" name="title" />
                </div>
                <div class="inputSection">
                    <label for="year">Year: </label>
                    <input id="yearField" type="text" name="year" />
                </div>
                <div class="inputSection">
                    <label for="actor">Actor: </label>
                    <input id="actorField" type="text" name="actor" />
                </div>
                <div class="inputSection">
                    <label for="director">Director: </label>
                    <input id="directorField" type="text" name="director" />
                </div>
                <div class="inputSection">
                    <label for="grossing">Grossing: </label>
                    <select id="grossingComp">
                        <option value=">"> > </option>
                        <option value="<">
                            < </option>
                    </select>
                    <input id="grossingNumber" type="text" name="grossing" />
                </div>
                <div class="inputSection">
                    <label for="duration">Duration: </label>
                    <select id="durationComp">
                        <option value=">"> > </option>
                        <option value="<">
                            < </option>
                    </select>
                    <input id="durationNumber" type="text" name="duration" />
                </div>
                <div class="inputSection">
                    <label for="imdb">IMDB Rating: </label>
                    <input id="imdbField" type="text" name="imdb" />
                </div>
                <div class="inputSection">
                    <label for="rottenTomatoes">Rotten Tomatoes Rating: </label>
                    <input id="rottenTomatoesField" type="text" name="rottenTomatoes" />
                </div>
                <div class="inputSection">
                    <label><input type="radio" name="method" value="GET"> GET</label>
                    <label><input type="radio" name="method" value="HEAD"> HEAD</label>
                </div>
                <button type="submit">Send Request</button>
            </form>

        </section>
        <hr>
        <!-- Test Movie Titles Endpoint -->
        <section id="movieTitles" class="endpoint">
            <h2>Test movie titles</h2>
            <form data-method="GET" action="/movieTitles">
                <div class="inputSection">
                    <label for="title">Title: </label>
                    <input id="titleField" type="text" name="title" />
                </div>
                <div class="inputSection">
                    <label for="year">Year: </label>
                    <input id="yearField" type="text" name="year" />
                </div>
                <div class="inputSection">
                    <label for="actor">Actor: </label>
                    <input id="actorField" type="text" name="actor" />
                </div>
                <div class="inputSection">
                    <label for="director">Director: </label>
                    <input id="directorField" type="text" name="director" />
                </div>
                <div class="inputSection">
                    <label><input type="radio" name="method" value="GET"> GET</label>
                    <label><input type="radio" name="method" value="HEAD"> HEAD</label>
                </div>
                <button type="submit">Send Request</button>
            </form>
        </section>
        <hr>
        <!-- Test Movie Details Endpoint -->
        <section id="movieDetails" class="endpoint">
            <h2>Test movie details</h2>
            <form data-method="GET" action="/movieByDetails">
                <div class="inputSection">
                    <label for="grossing">Grossing: </label>
                    <select id="grossingComp">
                        <option value=">"> > </option>
                        <option value="<">
                            < </option>
                    </select>
                    <input id="grossingNumber" type="text" name="grossing" />
                </div>
                <div class="inputSection">
                    <label for="duration">Duration: </label>
                    <select id="durationComp">
                        <option value=">"> > </option>
                        <option value="<">
                            < </option>
                    </select>
                    <input id="durationNumber" type="text" name="duration" />
                </div>
                <div class="inputSection">
                    <label><input type="radio" name="method" value="GET"> GET</label>
                    <label><input type="radio" name="method" value="HEAD"> HEAD</label>
                </div>
                <button type="submit">Send Request</button>
            </form>
        </section>
        <hr>
        <!-- Test Movie Rating Endpoint -->
        <section id="movieRating" class="endpoint">
            <h2>Test movie rating</h2>
            <form data-method="GET" action="/movieByRating">
                <div class="inputSection">
                    <label for="imdb">IMDB Rating: </label>
                    <input id="imdbField" type="text" name="imdb" />
                </div>
                <div class="inputSection">
                    <label for="rottenTomatoes">Rotten Tomatoes Rating: </label>
                    <input id="rottenTomatoesField" type="text" name="rottenTomatoes" />
                </div>
                <div class="inputSection">
                    <label><input type="radio" name="method" value="GET"> GET</label>
                    <label><input type="radio" name="method" value="HEAD"> HEAD</label>
                </div>
                <button type="submit">Send Request</button>
            </form>
        </section>
        <hr>
        <!-- Test Favorite Movies Endpoint -->
        <section id="favoriteMovies" class="endpoint">
            <h2>Test favorites</h2>
            <h3>Get Favorites</h3>
            <div id="getMovies">
                <form data-method="GET" action="/favoriteMovies">
                    <div class="inputSection">
                        <label><input type="radio" name="method" value="GET"> GET</label>
                        <label><input type="radio" name="method" value="HEAD"> HEAD</label>
                    </div>
                    <button type="submit">Send Request</button>
                </form>
            </div>
            <h3>Add Favorite</h3>
            <div id="addMovie">
                <form data-method="POST" action="/addFavorite">
                    <div class="inputSection">
                        <label for="favTitle">Title: </label>
                        <input id="favTitleField" type="text" name="favTitle" />
                    </div>
                    <button type="submit">Send Request</button>
                </form>
            </div>
        </section>
        <hr>
        <!-- Test Rating Endpoint -->
        <section id="addRating" class="endpoint">
            <h2>Test Rating</h2>
            <form data-method="POST" action="/addRating">
                <div class="inputSection">
                    <label for="title">Title: </label>
                    <input id="titleField" type="text" name="title" />
                </div>
                <div class="inputSection">
                    <label for="rating">Rating: </label>
                    <input id="ratingField" type="text" name="rating" />
                </div>
                <button type="submit">Send Request</button>
            </form>
        </section>
    </div>
    <!-- Content section (filled by code) -->
    <section id="content">

    </section>

    <script>
        // endpoints
        const allMoviesSection = document.querySelector('#allMovies');
        const movieTitlesSection = document.querySelector('#movieTitles');
        const movieDetailsSection = document.querySelector('#movieDetails');
        const movieRatingSection = document.querySelector('#movieRating');
        const favoriteMoviesSection = document.querySelector('#favoriteMovies');
        const getFavoritesSection = favoriteMoviesSection.querySelector('#getMovies');
        const addFavoritesSection = favoriteMoviesSection.querySelector('#addMovie');
        const personalRatingSection = document.querySelector('#addRating');

        // content
        const contentSection = document.querySelector('#content');

        // buttons
        const allMoviesButton = allMoviesSection.querySelector('button');
        const movieTitlesButton = movieTitlesSection.querySelector('button');
        const movieDetailsButton = movieDetailsSection.querySelector('button');
        const movieRatingButton = movieRatingSection.querySelector('button');
        const getFavoritesButton = getFavoritesSection.querySelector('button');
        const addFavoritesButton = addFavoritesSection.querySelector('button');
        const personalRatingButton = personalRatingSection.querySelector('button');

        // button arrays for dynamic event listener assignment
        const getButtons = [allMoviesButton, movieTitlesButton, movieDetailsButton, movieRatingButton, getFavoritesButton];
        const postButtons = [addFavoritesButton, personalRatingButton];

        // gets data based on url
        const getData = async (e) => {
            const form = e.target.parentElement;

            let customURL = form.action;

            // add query parameters based on which section you're in
            // if you're in movie Titles or all moveis
            if (form.action.endsWith('/movieTitles') || form.action.endsWith('/allMovies')) {
                // get input values
                let title = form.querySelector('#titleField').value;
                let year = form.querySelector('#yearField').value;
                let actor = form.querySelector('#actorField').value;
                let director = form.querySelector('#directorField').value;

                // add query params based on what inputs have values and whether there are other params
                if (title) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `title=${title}`;
                }
                if (year) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `year=${year}`;
                }
                if (actor) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `actor=${actor}`;
                }
                if (director) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `director=${director}`;
                }
            }
            // if you're in movie details or all moveis
            if (form.action.endsWith('/movieByDetails') || form.action.endsWith('/allMovies')) {
                // get input values
                let grossComp = form.querySelector('#grossingComp').value;
                let gross = form.querySelector('#grossingNumber').value;
                let durComp = form.querySelector('#durationComp').value;
                let dur = form.querySelector('#durationNumber').value;
                // add query params based on what inputs have values and whether there are other params
                if (gross) {
                    if (customURL.endsWith('/movieByDetails') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `grossing=${grossComp}${gross}`;
                }
                if (dur) {
                    if (customURL.endsWith('/movieByDetails') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `duration=${durComp}${dur}`;
                }
            }
            // if you're in movie rating or all moveis
            if (form.action.endsWith('/movieByRating') || form.action.endsWith('/allMovies')) {
                // get input values
                let imdb = form.querySelector('#imdbField').value;
                let tomatoes = form.querySelector('#rottenTomatoesField').value;
                // add query params based on what inputs have values and whether there are other params
                if (imdb) {
                    if (customURL.endsWith('/movieByRating') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `imdb=${imdb}`;
                }
                if (tomatoes) {
                    if (customURL.endsWith('/movieByRating') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `tomatoes=${tomatoes}`;
                }
            }

            const response = await fetch(customURL, {
                method: 'GET',
                headers: {
                    'accept': 'application/json',
                },
            });

            const result = await response.json();
            console.log(result);

            const dataHtml = dataToHtml(result, response.status, 'GET');
            console.log(dataHtml);

            contentSection.innerHTML = dataHtml;
        };

        // return head data
        const getHead = async (e) => {
            const form = e.target.parentElement;

            let customURL = form.action;

            // add query parameters based on which section you're in
            // if you're in movie Titles or all moveis
            if (form.action.endsWith('/movieTitles') || form.action.endsWith('/allMovies')) {
                // get input values
                let title = form.querySelector('#titleField').value;
                let year = form.querySelector('#yearField').value;
                let actor = form.querySelector('#actorField').value;
                let director = form.querySelector('#directorField').value;

                // add query params based on what inputs have values and whether there are other params
                if (title) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `title=${title}`;
                }
                if (year) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `year=${year}`;
                }
                if (actor) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `actor=${actor}`;
                }
                if (director) {
                    if (customURL.endsWith('/movieTitles') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `director=${director}`;
                }
            }
            // if you're in movie details or all moveis
            if (form.action.endsWith('/movieByDetails') || form.action.endsWith('/allMovies')) {
                // get input values
                let grossComp = form.querySelector('#grossingComp').value;
                let gross = form.querySelector('#grossingNumber').value;
                let durComp = form.querySelector('#durationComp').value;
                let dur = form.querySelector('#durationNumber').value;
                // add query params based on what inputs have values and whether there are other params
                if (gross) {
                    if (customURL.endsWith('/movieByDetails') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `grossing=${grossComp}${gross}`;
                }
                if (dur) {
                    if (customURL.endsWith('/movieByDetails') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `duration=${durComp}${dur}`;
                }
            }
            // if you're in movie rating or all moveis
            if (form.action.endsWith('/movieByRating') || form.action.endsWith('/allMovies')) {
                // get input values
                let imdb = form.querySelector('#imdbField').value;
                let tomatoes = form.querySelector('#rottenTomatoesField').value;
                // add query params based on what inputs have values and whether there are other params
                if (imdb) {
                    if (customURL.endsWith('/movieByRating') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `imdb=${imdb}`;
                }
                if (tomatoes) {
                    if (customURL.endsWith('/movieByRating') || customURL.endsWith('/allMovies')) {
                        customURL += '?'
                    } else {
                        customURL += '&'
                    }
                    customURL += `tomatoes=${tomatoes}`;
                }
            }

            const response = await fetch(customURL, {
                method: 'HEAD',
                headers: {
                    accept: 'application/json',
                },
            });

            const dataHtml = dataToHtml({}, response.status, 'HEAD');

            contentSection.innerHTML = dataHtml;
        };

        // convert data to html for content section
        const dataToHtml = (data, responseStatus, responseMethod) => {
            let dataHtml;
            // check response status and respond accordingly
            if (responseStatus === 200) {
                dataHtml = `<h1>Selected Movies</h1>`;
                if (responseMethod !== 'HEAD') {
                    dataHtml += `<p>${JSON.stringify(data.message)}</p>`;
                }
            } else if (responseStatus === 201) {
                dataHtml = '<h1>Created</h1>';
                if (responseMethod !== 'HEAD') {
                    dataHtml += `<p>Message: ${JSON.stringify(data.message)}</p>`;
                }
            } else if (responseStatus === 204) {
                dataHtml = '<h1>Updated (No Content)</h1>';
            } else if (responseStatus === 400) {
                dataHtml = '<h1>Bad Request</h1>'
                if (responseMethod !== 'HEAD') {
                    dataHtml += `<p>Message: ${JSON.stringify(data.message)}</p>`;
                }
            } else if (responseStatus === 404) {
                dataHtml = '<h1>Not Found</h1>'
                if (responseMethod !== 'HEAD') {
                    dataHtml += `<p>Message: ${v}</p>`;
                }
            }
            return dataHtml;
        };

        // event listener for get/head requests
        const getDataOnClick = async (e) => {
            e.preventDefault();

            const form = e.target.parentElement;
            let typeButtons = form.querySelectorAll('input[type="radio"]');
            let reqType = 'GET';

            typeButtons.forEach(button => {
                console.log(button);
                if (button.checked) {
                    reqType = button.value;
                }
            });

            console.log(reqType)

            if (reqType === 'HEAD') {
                await getHead(e);
            } else {
                await getData(e);
            }
        }

        // event listener for post requests
        const sendDataOnClick = async (e) => {
            e.preventDefault();

            const form = e.target.parentElement;
            console.log(form, form.action);
            let bodyContent;

            if (form.action.endsWith('/addFavorite')) {
                console.log(form.querySelector('#favTitleField').value);
                bodyContent = {
                    title: form.querySelector('#favTitleField').value
                };
            } else if (form.action.endsWith('/addRating')) {
                console.log(form.querySelector('#titleField').value);
                console.log(form.querySelector('#ratingField').value);
                bodyContent = {
                    title: form.querySelector('#titleField').value,
                    rating: form.querySelector('#ratingField').value,
                };
            }

            const response = await fetch(form.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(bodyContent),
            });
            console.log(response);

            let result;

            if (response.status !== 204) {
                result = await response.json();
            } else {
                result = {}
            }

            const dataHTML = dataToHtml(result, response.status, 'POST');

            contentSection.innerHTML = dataHTML;
        }


        // dynamically assign event listeners
        window.onload = (e) => {
            getButtons.forEach(button => {
                button.addEventListener('click', getDataOnClick);
            })
            postButtons.forEach(button => {
                button.addEventListener('click', sendDataOnClick);
            })
        };
    </script>
</body>

</html>